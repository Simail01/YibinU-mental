<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCL-90 ä¸“ä¸šå¿ƒç†æµ‹è¯„ - å¤§å­¦ç”Ÿå¿ƒç†å¥åº·æ™ºèƒ½åˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="uuid_manager.js"></script>
    <script src="config.js"></script>
</head>
<body>
    <div class="navbar">
        <div class="nav-inner">
            <div class="nav-logo">YibinU å¿ƒç†å¥åº·</div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="advice.html" class="nav-link">æ™ºèƒ½åˆ†æ</a>
                <a href="scl90.html" class="nav-link nav-link-active">ä¸“ä¸šè‡ªè¯„</a>
                <button class="theme-toggle" id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- å¼€å§‹é¡µé¢ -->
        <div id="start-screen" class="screen">
            <header class="text-center mb-4">
                <h1 class="main-title">SCL-90 ç—‡çŠ¶è‡ªè¯„é‡è¡¨</h1>
                <p class="intro">
                    SCL-90 æ˜¯å›½é™…å…¬è®¤çš„å¿ƒç†å¥åº·è¯„ä¼°å·¥å…·ï¼Œé€šè¿‡ 90 ä¸ªé¡¹ç›®ä»å¤šä¸ªç»´åº¦å…¨é¢äº†è§£æ‚¨çš„å¿ƒç†çŠ¶æ€ã€‚
                    è¯·æ ¹æ®æ‚¨<strong>æœ€è¿‘ä¸€å‘¨</strong>çš„å®é™…æ„Ÿå—è¿›è¡Œå¡«å†™ã€‚
                </p>
            </header>
            
            <form id="user-info-form" style="max-width: 500px; margin: 0 auto;">
                <div class="form-group">
                    <label for="nickname">æ‚¨çš„æ˜µç§°</label>
                    <input type="text" id="nickname" required placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°">
                </div>
                
                <div class="form-group">
                    <label for="birthday-input">å‡ºç”Ÿæ—¥æœŸ</label>
                    <input type="text" id="birthday-input" required placeholder="ç‚¹å‡»é€‰æ‹©æ—¥æœŸ" readonly>
                    <input type="hidden" id="birthday" name="birthday">
                </div>
                
                <div class="form-group">
                    <label for="gender">æ‚¨çš„æ€§åˆ«</label>
                    <select id="gender" required>
                        <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
                        <option value="ç”·">ç”·</option>
                        <option value="å¥³">å¥³</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="text-center mt-4">
                    <button type="submit" class="btn primary" style="width: 100%;">ğŸš€ å¼€å§‹ä¸“ä¸šæµ‹è¯„</button>
                    <button type="button" id="view-history" class="btn secondary mt-4" style="width: 100%;">ğŸ“œ æŸ¥çœ‹å¾€æœŸæ•°æ®</button>
                </div>
            </form>
        </div>

        <!-- å†å²è®°å½•é¡µé¢ -->
        <div id="history-screen" class="screen hidden">
             <header class="text-center mb-4">
                <h1 class="main-title">å¾€æœŸæµ‹è¯„è®°å½•</h1>
                <button id="history-back-btn" class="btn secondary mb-4">â† è¿”å›</button>
            </header>
            <div class="history-list-container" style="max-width: 800px; margin: 0 auto;">
                <table class="level-table">
                    <thead>
                        <tr>
                            <th>æµ‹è¯„æ—¶é—´</th>
                            <th>æ€»åˆ†</th>
                            <th>å‡åˆ†</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="history-tbody">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æµ‹è¯•é¡µé¢ -->
        <div id="test-screen" class="screen hidden">
            <div class="progress-container mb-4">
                <div class="progress-info mb-2">
                    <span id="current-question" style="font-weight: 700; color: var(--primary);">ç¬¬ 1 é¢˜</span>
                    <span id="remaining-questions" style="font-size: 0.85rem; color: var(--text-light);">å‰©ä½™ 89 é¢˜</span>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 1%;"></div>
                </div>
                <div class="timer mt-2 text-center" style="font-size: 0.9rem; color: var(--accent); font-weight: 600;">
                    â±ï¸ å‰©ä½™æ—¶é—´ï¼š<span id="time-left">45:00</span>
                </div>
            </div>
            
            <div class="text-section mt-4" style="min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <h2 id="question-text" style="text-align: center; font-size: 1.75rem; margin-bottom: 40px; color: var(--text-main);">åŠ è½½ä¸­...</h2>
                
                <div class="options-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; width: 100%; max-width: 800px;">
                    <label class="option-pill">
                        <input type="radio" name="answer" value="1" hidden>
                        <span>æ²¡æœ‰</span>
                    </label>
                    <label class="option-pill">
                        <input type="radio" name="answer" value="2" hidden>
                        <span>å¾ˆè½»</span>
                    </label>
                    <label class="option-pill">
                        <input type="radio" name="answer" value="3" hidden>
                        <span>ä¸­ç­‰</span>
                    </label>
                    <label class="option-pill">
                        <input type="radio" name="answer" value="4" hidden>
                        <span>åé‡</span>
                    </label>
                    <label class="option-pill">
                        <input type="radio" name="answer" value="5" hidden>
                        <span>ä¸¥é‡</span>
                    </label>
                </div>
            </div>
            
            <div class="navigation mt-4" style="display: flex; justify-content: space-between; gap: 16px;">
                <button id="prev-btn" class="btn secondary" disabled>â† ä¸Šä¸€é¢˜</button>
                <button id="next-btn" class="btn primary">ä¸‹ä¸€é¢˜ â†’</button>
            </div>
        </div>

        <!-- ç»“æœé¡µé¢ -->
        <div id="result-screen" class="screen hidden">
            <div class="result-container">
                <header class="text-center mb-4">
                    <h1 class="main-title">æµ‹è¯„åˆ†ææŠ¥å‘Š</h1>
                    <p class="text-muted">Symptom Checklist 90 (SCL-90)</p>
                </header>
                <div class="text-right mb-2 no-print">
                     <button id="back-to-home" class="btn secondary small">ğŸ  è¿”å›é¦–é¡µ</button>
                </div>

                <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
                <div class="text-section">
                    <h3 class="mb-4">ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div class="info-card">
                            <span class="text-light">å§“å/æ˜µç§°</span>
                            <div id="result-nickname" class="font-bold">--</div>
                        </div>
                        <div class="info-card">
                            <span class="text-light">æ€§åˆ«/å¹´é¾„</span>
                            <div class="font-bold"><span id="result-gender">--</span> / <span id="result-age">--</span>å²</div>
                        </div>
                        <div class="info-card">
                            <span class="text-light">æµ‹è¯„ç”¨æ—¶</span>
                            <div id="result-duration" class="font-bold">--</div>
                        </div>
                        <div class="info-card">
                            <span class="text-light">æµ‹è¯„æ—¶é—´</span>
                            <div id="result-test-time" class="font-bold">--</div>
                        </div>
                        <div class="info-card">
                            <span class="text-light">æµ‹è¯„æ€»åˆ†</span>
                            <div id="score-total-display" class="font-bold">--</div>
                        </div>
                    </div>
                </div>

                <!-- æ ¸å¿ƒè¯„åˆ† -->
                <div class="text-section mt-4">
                    <h3 class="mb-4">ğŸ“Š æ ¸å¿ƒè¯„åˆ†æ‘˜è¦</h3>
                    <table class="level-table">
                        <thead>
                            <tr>
                                <th>æ€»åˆ†</th>
                                <th>æ€»å‡åˆ†</th>
                                <th>é˜³æ€§é¡¹ç›®æ•°</th>
                                <th>çŠ¶æ€è¯„ä¼°</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="total-score" style="font-size: 1.25rem; font-weight: 800; color: var(--primary);">--</td>
                                <td id="average-score" style="font-size: 1.25rem; font-weight: 800;">--</td>
                                <td id="positive-items" style="font-size: 1.25rem; font-weight: 800; color: var(--accent);">--</td>
                                <td><span id="score-range" class="status-pill status-normal">--</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ç»´åº¦ç»†åˆ† -->
                <div class="text-section mt-4">
                    <h3 class="mb-4">ğŸ” å› å­ç»´åº¦åˆ†æ</h3>
                    <table class="level-table" id="symptoms-table">
                        <thead>
                            <tr>
                                <th>ç—‡çŠ¶ç»´åº¦</th>
                                <th>åŸå§‹åˆ†</th>
                                <th>å› å­å‡åˆ†</th>
                                <th>é£é™©æç¤º</th>
                            </tr>
                        </thead>
                        <tbody id="symptoms-tbody">
                            <!-- åŠ¨æ€å¡«å…… -->
                        </tbody>
                    </table>
                    <p class="mt-4" style="font-size: 0.85rem; color: var(--text-light); text-align: center;">
                        * å› å­å‡åˆ† â‰¥ 2 åˆ†æç¤ºè¯¥ç»´åº¦å­˜åœ¨ä¸€å®šç¨‹åº¦çš„ç—‡çŠ¶å›°æ‰°ã€‚
                    </p>
                    <div id="factor-analysis" class="mt-4">
                        <!-- åŠ¨æ€å¡«å……å› å­åˆ†æ -->
                    </div>
                </div>

                <!-- å¯è§†åŒ–å›¾è¡¨ -->
                <div class="text-section mt-4">
                    <h3 class="mb-4">ğŸ“ˆ å¿ƒç†ç”»åƒ</h3>
                    <canvas id="result-chart" style="width: 100%; max-height: 400px;"></canvas>
                </div>

                <!-- ä¸“å®¶å»ºè®® -->
                <div class="text-section mt-4" id="expert-advice">
                    <h3 class="mb-4">ğŸ’Œ è´´å¿ƒå»ºè®®</h3>
                    <div id="personal-advice" style="line-height: 1.8; color: var(--text-main);">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="text-center mt-4 no-print">
                    <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;">
                        <button id="download-pdf" class="btn primary">ğŸ“¥ ä¸‹è½½ PDF æŠ¥å‘Š</button>
                        <button id="download-image" class="btn secondary">ğŸ–¼ï¸ ä¿å­˜ç»“æœå›¾ç‰‡</button>
                        <button id="save-to-kb" class="btn secondary">ğŸ’¾ ä¿å­˜è‡³çŸ¥è¯†åº“</button>
                        <button id="back-to-history" class="btn secondary hidden">ğŸ“œ è¿”å›åˆ—è¡¨</button>
                        <button id="restart-test" class="btn secondary">â†©ï¸ é‡æ–°æµ‹è¯„</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”Ÿæ—¥é€‰æ‹©æ¨¡æ€çª— (é‡å¡‘è®¾è®¡) -->
    <div id="birthday-modal" class="modal">
        <div class="modal-content screen" style="max-width: 400px; padding: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ</h3>
                <button class="modal-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="date-picker">
                <div class="date-picker-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <div style="display: flex; gap: 8px;">
                        <button id="prev-year" class="btn secondary" style="min-width: auto; padding: 4px 12px;" title="ä¸Šä¸€å¹´">&lt;&lt;</button>
                        <button id="prev-month" class="btn secondary" style="min-width: auto; padding: 4px 12px;" title="ä¸Šä¸€æœˆ">&lt;</button>
                    </div>
                    <span id="current-month-year" style="font-weight: 700;"></span>
                    <div style="display: flex; gap: 8px;">
                        <button id="next-month" class="btn secondary" style="min-width: auto; padding: 4px 12px;" title="ä¸‹ä¸€æœˆ">&gt;</button>
                        <button id="next-year" class="btn secondary" style="min-width: auto; padding: 4px 12px;" title="ä¸‹ä¸€å¹´">&gt;&gt;</button>
                    </div>
                </div>
                <div id="calendar-days" class="calendar-days" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center;">
                    <!-- åŠ¨æ€å¡«å…… -->
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 8px; margin-top: 24px;">
                <button id="cancel-birthday" class="btn secondary">å–æ¶ˆ</button>
                <button id="confirm-birthday" class="btn primary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <style>
        /* é¡µé¢ç‰¹å®šæ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .calendar-days div {
            padding: 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .calendar-days div:hover { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .calendar-days .selected { background: var(--primary); color: white; }
        .calendar-days .today { color: var(--primary); font-weight: 800; text-decoration: underline; }
        
        .no-print { display: flex; }
        @media print { .no-print { display: none !important; } .navbar { display: none; } .screen { box-shadow: none; border: none; } }
    </style>

    <script src="script.js"></script>
</body>
</html>
